[doc Testing of output when features have been enabled]

[include features.luxinc]

[invoke setup]

[newshell compile]
    !export ERLC_USE_SERVER=false
    ?SH-PROMPT:
    # This file has instances of -compile({enable_feature, ..}) inside
    [invoke compile feature_directive_maybe_ifn.erl "-enable-feature ifn_expr"]
    ?SH-PROMPT:
    [invoke ok]


[newshell erl]
    -undefined function
    !erl -pa $outdir
    ?$ERLPROMPT

    # Output should should know about the new reserved words during runtime

    [invoke same-members "erl_features:enable_feature(maybe_expr)" "[cond_expr,maps,maybe_expr]"]

    [invoke same-members "erl_features:enable_feature(ifn_expr)" "[cond_expr,maps,maybe_expr,ifn_expr]"]

    !l(feature_directive_maybe_ifn).
    ??{module,feature_directive_maybe_ifn}
    ?$ERLPROMPT

    !feature_directive_maybe_ifn:foo().
    ??['ifn','maybe','else','if']
    ?$ERLPROMPT

    !erl_features:enable_feature(ifn_expr).
    ?[ifn_expr,maybe_expr]
    ?$ERLPROMPT

    # FIXME not needed here anymore - we do it above to be able to
    # load the module explicitly
    !feature_directive_maybe_ifn:foo().
    ??['ifn','maybe','else','if']
    ?$ERLPROMPT

[cleanup]
    !rm -fr $outdir
