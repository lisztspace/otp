[doc Testing of enabling features on command line]

[include features.luxinc]

[invoke setup]

[newshell erl]
    [invoke start-erl ""]

    !features:enabled_features().
    ??[]
    ?$ERLPROMPT

    [invoke quit-erl]

    [invoke start-erl "-enable-feature ifn_expr"]

    !features:enabled_features().
    ??[ifn_expr]
    ?$ERLPROMPT

    [invoke quit-erl]

    [invoke start-erl "-enable-feature ifn_expr -enable-feature maybe_expr"]

    !features:enabled_features().
    # We know that new features are pushed
    ??[maybe_expr,ifn_expr]
    ?$ERLPROMPT

    [invoke quit-erl]


    [invoke start-erl "-enable-feature ifn_expr maybe_expr"]

    !features:enabled_features().
    # We know that new features are pushed
    ??[maybe_expr,ifn_expr]
    ?$ERLPROMPT

    [invoke quit-erl]

    [invoke start-erl "-enable-feature ifn_expr maybe_expr -enable-feature ifnot_expr"]

    !features:enabled_features().
    # We know that new features are pushed
    ??[ifnot_expr,maybe_expr,ifn_expr]
    ?$ERLPROMPT

    [invoke quit-erl]

    # Enabling the same feature twice does not hurt
    [invoke start-erl "-enable-feature ifn_expr maybe_expr -enable-feature ifnot_expr ifn_expr"]

    !features:enabled_features().
    # We know that new features are pushed
    ??[ifnot_expr,maybe_expr,ifn_expr]
    ?$ERLPROMPT

    [invoke quit-erl]

    # Now for some bad stuff
    # Enabling a feature that doen't exist
    # FIXME shouldn't this give an error?
    [invoke start-erl "-enable-feature no_ftr"]

    !features:enabled_features().
    ??[]
    ?$ERLPROMPT

    [invoke quit-erl]

    # Enabling a feature that doen't exist
    [invoke start-erl "-enable-feature no_ftr"]

    !features:enabled_features().
    ??[]
    ?$ERLPROMPT

    [invoke quit-erl]

[cleanup]
    # done
